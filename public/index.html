\
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chartjs</title>
</head>

<body>
    <div style="width: 100vh; height: 100vh;">
        <canvas id="myChart"></canvas>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // === include 'setup' then 'config' above ===
        const datas = [
    {
      "departement": "Ain",
      "ensemble_de_la_zone": 10.2,
      "commune_la_moins_exposee": 6,
      "commune_la_plus_exposee": 12,
      "nombre_de_communes_up10": 245,
      "nombre_de_communes_up10_100": 60,
      "population_up10": 446921,
      "population_up10_100": 70
    },
    {
      "departement": "Allier",
      "ensemble_de_la_zone": 9.6,
      "commune_la_moins_exposee": 6,
      "commune_la_plus_exposee": 10.9,
      "nombre_de_communes_up10": 37,
      "nombre_de_communes_up10_100": 12,
      "population_up10": 116877,
      "population_up10_100": 34
    },
    {
      "departement": "Ardèche",
      "ensemble_de_la_zone": 9.3,
      "commune_la_moins_exposee": 5,
      "commune_la_plus_exposee": 12.9,
      "nombre_de_communes_up10": 45,
      "nombre_de_communes_up10_100": 13,
      "population_up10": 92188,
      "population_up10_100": 28
    },
    {
      "departement": "Cantal",
      "ensemble_de_la_zone": 7.1,
      "commune_la_moins_exposee": 5.2,
      "commune_la_plus_exposee": 9.3,
      "nombre_de_communes_up10": 0,
      "nombre_de_communes_up10_100": 0,
      "population_up10": 0,
      "population_up10_100": 0
    },
    {
      "departement": "Drôme",
      "ensemble_de_la_zone": 10.7,
      "commune_la_moins_exposee": 5,
      "commune_la_plus_exposee": 13,
      "nombre_de_communes_up10": 100,
      "nombre_de_communes_up10_100": 27,
      "population_up10": 387111,
      "population_up10_100": 76
    },
    {
      "departement": "Isère",
      "ensemble_de_la_zone": 11.3,
      "commune_la_moins_exposee": 5.4,
      "commune_la_plus_exposee": 14.3,
      "nombre_de_communes_up10": 238,
      "nombre_de_communes_up10_100": 46,
      "population_up10": 1009764,
      "population_up10_100": 81
    },
    {
      "departement": "Loire",
      "ensemble_de_la_zone": 9.5,
      "commune_la_moins_exposee": 5.9,
      "commune_la_plus_exposee": 11.7,
      "nombre_de_communes_up10": 43,
      "nombre_de_communes_up10_100": 13,
      "population_up10": 219951,
      "population_up10_100": 29
    },
    {
      "departement": "Haute-Loire",
      "ensemble_de_la_zone": 7.5,
      "commune_la_moins_exposee": 5,
      "commune_la_plus_exposee": 9.1,
      "nombre_de_communes_up10": 0,
      "nombre_de_communes_up10_100": 0,
      "population_up10": 0,
      "population_up10_100": 0
    },
    {
      "departement": "Puy-de-Dôme",
      "ensemble_de_la_zone": 9.2,
      "commune_la_moins_exposee": 5,
      "commune_la_plus_exposee": 10.9,
      "nombre_de_communes_up10": 17,
      "nombre_de_communes_up10_100": 4,
      "population_up10": 232562,
      "population_up10_100": 36
    },
    {
      "departement": "Rhône",
      "ensemble_de_la_zone": 13,
      "commune_la_moins_exposee": 7,
      "commune_la_plus_exposee": 15.6,
      "nombre_de_communes_up10": 153,
      "nombre_de_communes_up10_100": 53,
      "population_up10": 1681941,
      "population_up10_100": 92
    },
    {
      "departement": "Savoie",
      "ensemble_de_la_zone": 10.9,
      "commune_la_moins_exposee": 5.9,
      "commune_la_plus_exposee": 13.2,
      "nombre_de_communes_up10": 122,
      "nombre_de_communes_up10_100": 43,
      "population_up10": 302646,
      "population_up10_100": 70
    },
    {
      "departement": "Haute-Savoie",
      "ensemble_de_la_zone": 11.4,
      "commune_la_moins_exposee": 7,
      "commune_la_plus_exposee": 13.7,
      "nombre_de_communes_up10": 168,
      "nombre_de_communes_up10_100": 60,
      "population_up10": 667583,
      "population_up10_100": 83
    }
  ]
        let datalist = []
        while(datalist.length!==datas.length){
            console.log(datalist.length)
            console.log(datas.length)
            console.log("")
            dataSelect = {ensemble_de_la_zone:1,departement:"null"}
            for(let i=0 ;i<datas.length;i++){
                console.log(datas[i].ensemble_de_la_zone)
                if(datalist.length){
                    console.log(datalist.length)
                    console.log(dataSelect.departement)
                    console.log(datas[i].departement)
                    console.log(datalist.at(-1).departement)
                    if (datas[i].departement!==datalist.at(-1).departement && datas[i].ensemble_de_la_zone<=datalist.at(-1).ensemble_de_la_zone && datas[i].ensemble_de_la_zone>=dataSelect.ensemble_de_la_zone)dataSelect = datas[i]
                }else if (datas[i].ensemble_de_la_zone>=dataSelect.ensemble_de_la_zone) dataSelect = datas[i]
                
                console.log(dataSelect)
                if(i === datas.length-1) datalist.push(dataSelect),console.log(datalist.length)
            }
            
        }
        const labels = [];
        const datasets = []
        let color = 0
        datalist.forEach(data => {
            labels.push(data.departement+" PROPRE (<10 μg/m3) ")
            labels.push(data.departement+" POLUE (>10 μg/m3) ")
            
            //while(color<oldcolor+50 && color>oldcolor-50)color=Math.floor(Math.random()*180+20)
            color+=230/datas.length
            console.log(color)
            if(data.departement==='Cantal')weight=144417
            else if(data.departement==='Haute-Loire')weight=227033
            else weight = (data.population_up10/data.population_up10_100)*100
            console.log(weight)
            datasets.push({backgroundColor: [`hsl(${color}, 100%, 60%)`, `hsl(${color}, 100%, 35%)`],
            data:[100-data.population_up10_100,data.population_up10_100,],weight:Math.sqrt(weight),
        
        })
        });
        const DATA_COUNT = 5;
        const NUMBER_CFG = { count: DATA_COUNT, min: 0, max: 100 };
        const data = {
            labels: labels,
            datasets: datasets
            
        };
        const config = {
            type: 'pie',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        labels: {
                            generateLabels: function (chart) {
                                // Get the default label list
                                const original = Chart.overrides.pie.plugins.legend.labels.generateLabels;
                                const labelsOriginal = original.call(this, chart);

                                // Build an array of colors used in the datasets of the chart
                                var datasetColors = chart.data.datasets.map(function (e) {
                                    return e.backgroundColor;
                                });
                                datasetColors = datasetColors.flat();

                                // Modify the color and hide state of each label
                                labelsOriginal.forEach(label => {
                                    // There are twice as many labels as there are datasets. This converts the label index into the corresponding dataset index
                                    label.datasetIndex = (label.index - label.index % 2) / 2;

                                    // The hidden state must match the dataset's hidden state
                                    label.hidden = !chart.isDatasetVisible(label.datasetIndex);

                                    // Change the color to match the dataset
                                    label.fillStyle = datasetColors[label.index];
                                });

                                return labelsOriginal;
                            }
                        },
                        onClick: function (mouseEvent, legendItem, legend) {
                            // toggle the visibility of the dataset from what it currently is
                            legend.chart.getDatasetMeta(
                                legendItem.datasetIndex
                            ).hidden = legend.chart.isDatasetVisible(legendItem.datasetIndex);
                            legend.chart.update();
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const labelIndex = (context.datasetIndex * 2) + context.dataIndex;
                                return context.chart.data.labels[labelIndex] + ': ' + context.formattedValue;
                            }
                        }
                    }
                }
            },
        };
        var myChart = new Chart(
            document.getElementById('myChart'),
            config
        );
    </script>
</body>

</html>